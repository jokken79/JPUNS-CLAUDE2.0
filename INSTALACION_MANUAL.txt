# INSTALACION MANUAL - UNS-ClaudeJP
# Si el script install-windows.bat falla, sigue estos pasos

# ============================================
# PASO 1: VERIFICAR DOCKER
# ============================================

# Abrir PowerShell o CMD y ejecutar:
docker --version
docker-compose --version

# Si aparece error, instalar Docker Desktop:
# https://www.docker.com/products/docker-desktop


# ============================================
# PASO 2: CREAR CARPETAS
# ============================================

# Navegar al proyecto:
cd D:\UNS-JPClaude

# Crear carpetas necesarias:
mkdir uploads
mkdir logs
mkdir config\factories


# ============================================
# PASO 3: CREAR ARCHIVO .env
# ============================================

# Copiar el ejemplo:
copy .env.example .env

# Abrir con notepad:
notepad .env

# CAMBIAR ESTOS VALORES:
# DB_PASSWORD=tu_password_seguro
# SECRET_KEY=una_clave_muy_larga_y_aleatoria_minimo_32_caracteres


# ============================================
# PASO 4: CONSTRUIR IMAGENES DOCKER
# ============================================

docker-compose build

# Esto tomará 5-10 minutos la primera vez


# ============================================
# PASO 5: INICIAR SERVICIOS
# ============================================

docker-compose up -d


# ============================================
# PASO 6: VERIFICAR QUE TODO FUNCIONA
# ============================================

# Ver estado de contenedores:
docker-compose ps

# Debe mostrar 3 contenedores "Up":
# - uns-claudejp-backend
# - uns-claudejp-frontend  
# - uns-claudejp-db


# ============================================
# PASO 7: ACCEDER AL SISTEMA
# ============================================

# Abrir en navegador:
# http://localhost:3000

# Login:
# Usuario: admin
# Password: admin123


# ============================================
# COMANDOS UTILES
# ============================================

# Ver logs en tiempo real:
docker-compose logs -f

# Ver logs de un servicio específico:
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f db

# Detener servicios:
docker-compose stop

# Iniciar servicios:
docker-compose start

# Reiniciar servicios:
docker-compose restart

# Eliminar todo (¡cuidado!):
docker-compose down -v


# ============================================
# SOLUCION DE PROBLEMAS
# ============================================

# Si puerto 3000 o 8000 está ocupado:
netstat -ano | findstr :3000
netstat -ano | findstr :8000
# Matar proceso con: taskkill /PID [numero] /F

# Si la base de datos no inicia:
docker-compose logs db
docker-compose restart db

# Si el frontend no carga:
docker-compose logs frontend
docker-compose restart frontend

# Si el backend da error:
docker-compose logs backend
docker-compose restart backend

# Para reconstruir todo desde cero:
docker-compose down -v
docker-compose build --no-cache
docker-compose up -d


# ============================================
# BACKUP DE BASE DE DATOS
# ============================================

# Crear backup:
docker-compose exec db pg_dump -U uns_admin uns_claudejp > backup.sql

# Restaurar backup:
type backup.sql | docker-compose exec -T db psql -U uns_admin uns_claudejp


# ============================================
# ACCESO DESDE RED LOCAL
# ============================================

# Obtener IP de tu PC:
ipconfig

# Buscar "IPv4 Address", ejemplo: 192.168.1.100
# Acceder desde otro dispositivo:
# http://192.168.1.100:3000
